## MQ 对比

| 　       | RabbitMQ                                                                                                                                                                       | ActiveMQ                                                                                                                                                                                                                                                                                                                                                                     | RocketMQ                                                                                                                                                                                                                                       | Kafka                                                                                                                                                                                                                                                                                 |
| :------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 所属社区/公司 | Mozilla                                                                                                                                                                        | Apache                                                                                                                                                                                                                                                                                                                                                                       | Ali                                                                                                                                                                                                                                            | Apache                                                                                                                                                                                                                                                                                |
| 是否开源    | 是                                                                                                                                                                              | 是                                                                                                                                                                                                                                                                                                                                                                            | 是                                                                                                                                                                                                                                              | 是                                                                                                                                                                                                                                                                                     |
| 开发语言    | Erlang                                                                                                                                                                         | Java                                                                                                                                                                                                                                                                                                                                                                         | Java                                                                                                                                                                                                                                           | Scala\&Java                                                                                                                                                                                                                                                                           |
| 客户端支持语言 | 官方支持Erlang、JavaRuby等。社区产出多种语言API，几乎支持所有常用语言                                                                                                                                    | Java、C、C++、Python、PHP、Perl、.net等                                                                                                                                                                                                                                                                                                                                             | Java C++不成熟                                                                                                                                                                                                                                    | 官方支持Java开源社区有多语言版本如PHP.Python Go,CC++, RubyNodeJS等编程语言详见Kafka 客户端列表                                                                                                                                                                                                                   |
| 支持协议    | AMQP,XMPP,SMTP,STOMP                                                                                                                                                           | JMS,OpenWire,AMQP,XMPP,STOMP,REST                                                                                                                                                                                                                                                                                                                                            | 自定义协议 社区提供JMS但不成熟                                                                                                                                                                                                                              | 自定义协议 社区封装HTTP                                                                                                                                                                                                                                                                        |
| 消息批量操作  | 否                                                                                                                                                                              | 是                                                                                                                                                                                                                                                                                                                                                                            | 是                                                                                                                                                                                                                                              | 是                                                                                                                                                                                                                                                                                     |
| 消息推拉模式  | 多协议，Pull/Push均支持                                                                                                                                                               | 多协议，Pull/Push均支持                                                                                                                                                                                                                                                                                                                                                             | 多协议，Pull/Push均支持                                                                                                                                                                                                                               | Pull                                                                                                                                                                                                                                                                                  |
| HA      | master/slave模式master提供服务slave仅作备份                                                                                                                                              | 基于ZooKeeper+LeveIDB的MasterSlave实现方式                                                                                                                                                                                                                                                                                                                                          | 支持多Master模式、多Master多Slave模式，异步复制模式、多Master多Slave模式，同步双写                                                                                                                                                                                        | 支持replica机制制leader宿掉后.备份自动顶替，并重新选举leader(基于Zookeeper)                                                                                                                                                                                                                                 |
| 数据可霏性   | 可以保证数据不丢有slave用作备份                                                                                                                                                             | master/slave 有反馈有较低概率可能丢数据                                                                                                                                                                                                                                                                                                                                                   | 支持异步实时刷盘，同步刷盘，同步复制，异步复制                                                                                                                                                                                                                        | 数据可靠，并且有replica机制，有容错容灾能力 理论上不丢失，但可能有重复                                                                                                                                                                                                                                               |
| 单机香吐量   | 万级(第三)                                                                                                                                                                         | 万级(最差)                                                                                                                                                                                                                                                                                                                                                                       | 十万级(最高)                                                                                                                                                                                                                                        | 十万级(第二)                                                                                                                                                                                                                                                                               |
| 消息延迟    | 毫秒级                                                                                                                                                                            | 微秒级(最好)                                                                                                                                                                                                                                                                                                                                                                      | 比kalka快                                                                                                                                                                                                                                        | 毫秒级                                                                                                                                                                                                                                                                                   |
| 持久化能力   | 内存、文件，支持数据堆积.但数据堆积反过来影响生产速率                                                                                                                                                    | 内存、文件、数据库                                                                                                                                                                                                                                                                                                                                                                    | 磁盘文件                                                                                                                                                                                                                                           | 磁盘文件，只要磁盘容量够，可以做到无限消息堆积                                                                                                                                                                                                                                                               |
| 是否有序    | 若想有序，只能使用一个Client                                                                                                                                                              | 可以支持有序                                                                                                                                                                                                                                                                                                                                                                       | 有序，broker 宕机后，消息会失败，不会乱序                                                                                                                                                                                                                       | 需要配置，有 broker 宕机后就会乱序                                                                                                                                                                                                                                                                 |
| 事务      | 不支持                                                                                                                                                                            | 支持                                                                                                                                                                                                                                                                                                                                                                           | 支持                                                                                                                                                                                                                                             | 不支持但可以通过Low Level API保证仅消费一次                                                                                                                                                                                                                                                          |
| 集群      | 支持                                                                                                                                                                             | 支持                                                                                                                                                                                                                                                                                                                                                                           | 支持                                                                                                                                                                                                                                             | 支持                                                                                                                                                                                                                                                                                    |
| 负载均衡    | 支持                                                                                                                                                                             | 支持                                                                                                                                                                                                                                                                                                                                                                           | 支持                                                                                                                                                                                                                                             | 支持                                                                                                                                                                                                                                                                                    |
| 管理界面    | 较好                                                                                                                                                                             | 一般                                                                                                                                                                                                                                                                                                                                                                           | 命令行界面                                                                                                                                                                                                                                          | 官方只提供了命令行版Yahoo开源自己的KafkaWeb管理界面Kafka-Manager                                                                                                                                                                                                                                         |
| 部署方式    | 独立                                                                                                                                                                             | 独立                                                                                                                                                                                                                                                                                                                                                                           | 独立                                                                                                                                                                                                                                             | 独立                                                                                                                                                                                                                                                                                    |
| 优点总结    | 1.由于 Erlang 语言的特性，消息队列性能较好，支持 高并发； 2.健壮、稳定、易用、跨平台、支持 多种语言、文档齐全； 3.有消息 确认机制 和 持久化机制，可靠性高； 4.高度可定制的 路由； 5.管理界面 较丰富，在互联网公司也有较大规模的应用，社区活跃度高。                                       | 1.跨平台 (JAVA 编写与平台无关，ActiveMQ 几乎可以运行在任何的 JVM 上)； 2.可以用 JDBC：可以将 数据持久化 到数据库。虽然使用 JDBC 会降低 ActiveMQ 的性能，但是数据库一直都是开发人员最熟悉的存储介质； 3.支持 JMS 规范：支持 JMS 规范提供的 统一接口; 4.支持 自动重连 和 错误重试机制； 5.有安全机制：支持基于 shiro，jaas 等多种 安全配置机制，可以对 Queue/Topic 进行 认证和授权； 6.监控完善：拥有完善的 监控，包括 Web Console，JMX，Shell 命令行，Jolokia 的 RESTful API； 7.界面友善：提供的 Web Console 可以满足大部分情况，还有很多 第三方的组件 可以使用，比如 hawtio； | 1.单机 支持 1 万以上 持久化队列； 2.RocketMQ 的所有消息都是 持久化的，先写入系统 PAGECACHE，然后 刷盘，可以保证 内存 与 磁盘 都有一份数据，而 访问 时，直接 从内存读取。 3.模型简单，接口易用（JMS 的接口很多场合并不太实用）； 4.性能非常好，可以允许 大量堆积消息 在 Broker 中； 5.支持 多种消费模式，包括 集群消费、广播消费等； 6.各个环节 分布式扩展设计，支持 主从 和 高可用； 7.开发度较活跃，版本更新很快。 | 1.客户端语言丰富：支持 Java、.Net、PHP、Ruby、Python、Go 等多种语言； 2.高性能：单机写入 TPS 约在 100 万条/秒，消息大小 10 个字节； 3.提供 完全分布式架构，并有 replica 机制，拥有较高的 可用性 和 可靠性，理论上支持 消息无限堆积； 4.支持批量操作； 5.消费者 采用 Pull 方式获取消息。消息有序，通过控制 能够保证所有消息被消费且仅被消费 一次； 6.有优秀的第三方 Kafka Web 管理界面 Kafka-Manager； 7.在 日志领域 比较成熟，被多家公司和多个开源项目使用。 |
| 缺点总结    | 1.尽管结合 Erlang 语言本身的并发优势，性能较好，但是不利于做 二次开发和维护； 2.实现了 代理架构，意味着消息在发送到客户端之前可以在 中央节点 上排队。此特性使得 RabbitMQ 易于使用和部署，但是使得其 运行速度较慢，因为中央节点 增加了延迟，消息封装后 也比较大； 3.需要学习 比较复杂 的 接口和协议，学习和维护成本较高。 | 1.社区活跃度不及 RabbitMQ 高； 2.根据其他用户反馈，会出莫名其妙的问题，会 丢失消息； 3.目前重心放到 Apollo，维护较少； 4.不适合用于 上千个队列 的应用场景；                                                                                                                                                                                                                                                                                | 1.支持的 客户端语言 不多，目前是 Java 及 C++，其中 C++ 还不成熟； 2.RocketMQ 社区关注度及成熟度也不及前两者； 3.没有 Web 管理界面，提供了一个 CLI (命令行界面) 管理工具带来 查询、管理 和 诊断各种问题； 4.没有在 MQ 核心里实现 JMS 等接口；                                                                                          | 1.Kafka 单机超过 64 个 队列/分区 时，Load 时会发生明显的飙高现象。队列 越多，负载 越高，发送消息 响应时间变长； 2.使用 短轮询方式，实时性 取决于 轮询间隔时间； 3.消费失败 不支持重试； 4.支持 消息顺序，但是 一台代理宕机 后，就会产生 消息乱序； 5.社区更新较慢。                                                                                                                               |

## 推拉模式对比

| 　     | Push                                                              | Pull                                                 |
| :---- | :---------------------------------------------------------------- | :--------------------------------------------------- |
| 服务端   | 消息存储 处理请求 保存推送轨迹 保存订阅关系 消费者负载均衡 集中式                               | 消息存储 处理请求 分布式                                        |
| 客户端   | 处理响应和请求                                                           | 处理响应和请求 保存pull状态，如拉取位置的偏移量 offset 异常情况下的消息暂存和recover |
| 实时性   | 较好，收到数据后可立即发送给客户端                                                 | 取决于pull的间隔时间                                         |
| 消费者故障 | 消费者故障情况下，服务端堆积消息，重复推送耗费资源。 保存推送轨迹压力很大                             | 消费者故障，对服务端无影响                                        |
| 其他    | 对消息推送有更多控制，能实现多样化的推送机制。 当消费者数量增多的时候，推送压力大，性能天花板。 消费者处理能力差异，导致堆消息。 | 需要在客户端实现消息过滤，浪费资源。 需要在不同客户端之间协调，做负载均衡。               |

